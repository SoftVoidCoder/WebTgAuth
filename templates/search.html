{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/static/css/music.css">
{% endblock %}

{% block title %}–ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏{% endblock %}

{% block content %}
<section class="search-hero">
    <h1>üîç –ü–æ–∏—Å–∫ –º—É–∑—ã–∫–∏</h1>
    
    <div class="search-container">
        <form method="get" action="/music/search" class="search-form">
            <input 
                type="text" 
                name="query" 
                class="search-input" 
                placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, —Ç—Ä–µ–∫ –∏–ª–∏ –∞–ª—å–±–æ–º..."
                value="{{ search_query if search_query }}"
                autofocus
            >
            <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
        </form>
    </div>
</section>

{% if search_query %}
    {% if artists %}
    <section class="artists-section">
        <h2 class="section-title">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</h2>
        <div class="artists-grid">
            {% for artist in artists %}
            <div class="artist-card" onclick="window.location.href='/music/artist/{{ artist.id }}'">
                <div class="artist-image">
                    {% if artist.cover %}
                    <img src="{{ artist.cover.uri.replace('%%', '300x300') }}" alt="{{ artist.name }}" class="artist-cover">
                    {% else %}
                    <div class="artist-placeholder">{{ artist.name[0] }}</div>
                    {% endif %}
                </div>
                <div class="artist-info">
                    <h3 class="artist-name">{{ artist.name }}</h3>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if tracks %}
    <section class="tracks-section">
        <h2 class="section-title">–¢—Ä–µ–∫–∏</h2>
        <div class="tracks-grid">
            {% for track in tracks %}
            <div class="track-card" data-track-id="{{ track.id }}_{{ track.albums[0].id if track.albums else track.id }}">
                <div class="track-image">
                    {% if track.cover_uri %}
                    <img src="https://{{ track.cover_uri.replace('%%', '300x300') }}" alt="{{ track.title }}" class="track-cover">
                    {% else %}
                    <div class="track-placeholder">üéµ</div>
                    {% endif %}
                </div>
                
                <div class="track-info">
                    <h3 class="track-title">{{ track.title }}</h3>
                    <p class="track-artist">
                        {% for artist in track.artists %}
                        {{ artist.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                </div>
                
                <button class="play-btn" onclick="playTrack(this)">‚ñ∂</button>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if not tracks and not artists %}
    <div class="no-results">
        <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
    </div>
    {% endif %}
{% endif %}

<!-- –ê–£–î–ò–û –ü–õ–ï–ï–† -->
<div class="audio-player" id="audioPlayer" style="display: none;">
    <audio controls class="audio-element" id="audioElement">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã.
    </audio>
    <div class="now-playing" id="nowPlaying"></div>
</div>

<script src="/static/js/music.js"></script>
{% endblock %}