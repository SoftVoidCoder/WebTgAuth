{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/static/css/home.css">
{% endblock %}

{% block content %}
<section class="hero">
    <h1>Telegram Gift Exchange</h1>
    <p>–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±–º–µ–Ω –ø–æ–¥–∞—Ä–∫–∞–º–∏ —á–µ—Ä–µ–∑ Telegram</p>
    
    <!-- –ü–û–ò–°–ö –ú–£–ó–´–ö–ò -->
    <div class="search-container">
        <form method="get" action="/" class="search-form">
            <input 
                type="text" 
                name="query" 
                class="search-input" 
                placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π..."
                value="{{ search_query if search_query }}"
            >
            <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
        </form>
    </div>
    
    {% if not user_data %}
        <div class="auth-prompt">
            <p>–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
        </div>
    {% else %}
        <div class="welcome-message">
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user_data.first_name }}! üéÅ</p>
        </div>
    {% endif %}
</section>

<!-- –¢–†–ï–ö–ò -->
{% if tracks or popular_tracks %}
<section class="music-section">
    <h2 class="section-title">
        {% if search_query %}
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ search_query }}"
        {% else %}
            üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–∫–∏
        {% endif %}
    </h2>
    
    <div class="music-grid">
        {% for track in (tracks if tracks else popular_tracks) %}
        <div class="track-card" data-track-id="{{ track.id }}_{{ track.albums[0].id if track.albums else track.id }}">
            <div class="track-image">
                {% if track.cover_uri %}
                <img src="https://{{ track.cover_uri.replace('%%', '300x300') }}" alt="{{ track.title }}" class="track-cover">
                {% else %}
                <div class="track-placeholder">üéµ</div>
                {% endif %}
            </div>
            
            <div class="track-info">
                <h3 class="track-title">{{ track.title }}</h3>
                <p class="track-artist">
                    {% for artist in track.artists %}
                    {{ artist.name }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p class="track-album">{{ track.albums[0].title if track.albums else '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–ª—å–±–æ–º' }}</p>
                
                <div class="track-meta">
                    <span class="track-duration">
                        {% if track.duration_ms %}
                            {{ (track.duration_ms / 60000)|round(1) }} –º–∏–Ω
                        {% elif track.duration %}
                            {{ (track.duration / 60000)|round(1) }} –º–∏–Ω
                        {% else %}
                            –Ω–µ–∏–∑–≤.
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <button class="play-btn" onclick="playTrack(this)">‚ñ∂</button>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
<section class="features">
    <h2 class="section-title">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
    <div class="features-grid">
        <div class="feature-card">
            <h3>üéÅ –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</h3>
            <p>–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –≤ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ü–µ–Ω–æ–π</p>
        </div>
        <div class="feature-card">
            <h3>üîç –ù–∞–π–¥–∏—Ç–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
            <p>–ü–æ–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</p>
        </div>
        <div class="feature-card">
            <h3>üí≥ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–¥–µ–ª–∫–∞</h3>
            <p>–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±–º–µ–Ω —á–µ—Ä–µ–∑ Telegram</p>
        </div>
    </div>
</section>

<!-- –ê–£–î–ò–û –ü–õ–ï–ï–† -->
<div class="audio-player" id="audioPlayer" style="display: none;">
    <audio controls class="audio-element" id="audioElement">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã.
    </audio>
    <div class="now-playing" id="nowPlaying"></div>
</div>

<script src="/static/js/music.js"></script>
{% endblock %}