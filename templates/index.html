{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/static/css/home.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/charts.js"></script>
{% endblock %}

{% block content %}
<section class="hero">
    <h1>–£–ø—Ä–∞–≤–ª—è–π —Å–≤–æ–∏–º –∫—Ä–∏–ø—Ç–æ-–ø–æ—Ä—Ç—Ñ–µ–ª–µ–º</h1>
    <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –ø–æ–ª—É—á–∞–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∏ –±—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ç–µ–Ω–¥–µ–Ω—Ü–∏–π</p>
    
    {% if not user_data %}
        <div style="margin-top: 2rem;">
            <p style="margin-bottom: 1rem; color: #b0b0b0;">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
        </div>
    {% else %}
        <div style="margin-top: 2rem;">
            <p style="color: #00c6ff;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user_data.first_name }}! üöÄ</p>
        </div>
    {% endif %}
</section>

<section class="crypto-section">
    <h2 class="section-title">–¢–æ–ø –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã</h2>
    
    <div class="charts-container" id="cryptoContainer">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>
</section>

<script>
// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏ –≥—Ä–∞—Ñ–∏–∫–∏
async function loadCryptoData() {
    try {
        const response = await fetch('/crypto/prices');
        const data = await response.json();
        
        const container = document.getElementById('cryptoContainer');
        container.innerHTML = '';
        
        data.cryptos.forEach(crypto => {
            const changeClass = crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
            const changeSymbol = crypto.price_change_percentage_24h >= 0 ? '‚Üó' : '‚Üò';
            
            const cryptoCard = `
                <div class="chart-card">
                    <div class="chart-header">
                        <img src="${crypto.image}" alt="${crypto.name}" class="coin-logo">
                        <div class="coin-info">
                            <span class="coin-name">${crypto.name}</span>
                            <span class="coin-symbol">${crypto.symbol}</span>
                        </div>
                    </div>
                    <div class="price-section">
                        <div class="coin-price">$${crypto.current_price.toLocaleString()}</div>
                        <div class="price-change ${changeClass}">
                            ${changeSymbol} ${Math.abs(crypto.price_change_percentage_24h).toFixed(2)}%
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="chart-${crypto.symbol.toLowerCase()}"></canvas>
                    </div>
                    <div class="market-cap">
                        Market Cap: $${(crypto.market_cap / 1000000000).toFixed(2)}B
                    </div>
                </div>
            `;
            
            container.innerHTML += cryptoCard;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è —ç—Ç–æ–π –∫—Ä–∏–ø—Ç—ã
            loadChartData(crypto.id, crypto.symbol);
        });
        
    } catch (error) {
        console.error('Error loading crypto data:', error);
        document.getElementById('cryptoContainer').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
function startAutoRefresh() {
    setInterval(loadCryptoData, 120000);
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadCryptoData();
    startAutoRefresh();
});
</script>
{% endblock %}